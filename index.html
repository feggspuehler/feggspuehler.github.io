<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Scanner App</title>

  <!-- PWA Meta -->
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="manifest.json" />

  <!-- iOS Support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="QR Scanner" />

  <script src="https://unpkg.com/html5-qrcode"></script>

  <style>
    body { font-family: Arial, sans-serif; padding: 16px; background:#f8fafc; }
    h2 { text-align:center; }
    #reader { width:100%; max-width:360px; margin:auto; }
    ul { margin-top:20px; }
    button { padding:10px 14px; margin-top:10px; width:100%; }
  </style>
</head>
<body>
  <h2>ðŸ“± QR-Code Scanner</h2>
  <div id="reader"></div>

  <h3>Alphabetische Liste</h3>
  <ul id="list"></ul>
  <button onclick="downloadCSV()">CSV herunterladen</button>

<script>
  const entries = new Set();

  function updateList() {
    const list = document.getElementById('list');
    list.innerHTML = '';
    [...entries].sort((a,b)=>a.localeCompare(b)).forEach(e => {
      const li = document.createElement('li');
      li.textContent = e;
      list.appendChild(li);
    });
  }

  function onScanSuccess(text) {
    if (!entries.has(text)) {
      entries.add(text);
      updateList();
    }
  }

  new Html5QrcodeScanner(
    'reader',
    { fps: 10, qrbox: 250 },
    false
  ).render(onScanSuccess);

  function downloadCSV() {
    const csv = [...entries].sort((a,b)=>a.localeCompare(b)).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'qr_liste.csv';
    a.click();
  }

  // Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }
</script>
</body>
</html>
